/*
	Creating a new table to store the shooting guards and the like
*/
CREATE TABLE SHOOTING_GUARDS_2012 AS
SELECT PLAYER_ID, AGE, SEASON_ID, POSITION, GAMES, GAMES_STARTED, MINUTES_PLAYED, THREE_POINTS_FG, THREE_POINTS_FG_ATTEMPTS, TWO_POINTS_FG, TWO_POINTS_FG_ATTEMPTS, FREE_THROWS, FREE_THROWS_ATTEMPTS, ASSISTS, STEALS, POINTS
FROM T_TBL_PLAYERS_TOTALS 
WHERE POSITION IN ('SG','SG-SF', 'SG-PG', 'SG-PF')
AND SEASON_ID IN (SELECT SEASON_ID FROM T_TBL_SEASON
						  WHERE SEASON='2012-13');
/*
	There is a situation where the player has played for two teams in the same season 
	He might have played different positions in those teams
	We will retain row that gives the over all stats of the player in that season 
	This is because if he has played SG with some other position then we get to know that he is a versatile player
*/
DELETE FROM SHOOTING_GUARDS_2012 WHERE GAMES NOT IN(
SELECT MAX(GAMES) FROM SHOOTING_GUARDS_2012 GROUP BY PLAYER_ID);

/*
	If they have played for two teams in the same season then calculate the sum 
*/
DROP TABLE IF EXISTS PLAYER_SALARY_PER_SEASON;
CREATE TABLE PLAYER_SALARY_PER_SEASON AS
SELECT PLAYER_ID, T_TBL_SEASON.SEASON AS SEASON, T_TBL_SEASON.SEASON_ID AS SEASON_ID, SUM(SALARY) AS SALARY, TEAM FROM PLAYER_SALARY, T_TBL_SEASON
WHERE PLAYER_SALARY.SEASON = T_TBL_SEASON.SEASON
GROUP BY PLAYER_ID, PLAYER_SALARY.SEASON;

/*
	Now joining with the salary table to have everything in a single table for a season
*/
CREATE TABLE SHOOTING_GUARDS_2012_2013 AS
SELECT SHOOTING_GUARDS_2012.PLAYER_ID, SEASON_ID, AGE, POSITION, GAMES, GAMES_STARTED, MINUTES_PLAYED, FIELD_GOALS, FIELD_GOALS_ATTEMPTS, THREE_POINTS_FG, THREE_POINTS_FG_ATTEMPTS, TWO_POINTS_FG, TWO_POINTS_FG_ATTEMPTS, EFF_FIELD_GOAL_PERCENT, FREE_THROWS, FREE_THROWS_ATTEMPTS, ASSISTS, TURNOVERS, POINTS, TEAM, SALARY FROM SHOOTING_GUARDS_2012, PLAYER_SALARY_PER_SEASON
WHERE SHOOTING_GUARDS_2012.PLAYER_ID == PLAYER_SALARY_PER_SEASON.PLAYER_ID 
AND PLAYER_SALARY_PER_SEASON.SEASON='2012-13';


/* CONSIDERING ONLY THE PASAT 5 YEARS PERFORMANCE*/
CREATE TABLE SG_PREVIOUS5_SEASONS AS
SELECT * FROM T_TBL_PLAYERS_TOTALS
WHERE POSITION IN ('SG','SG-SF', 'SG-PG', 'SG-PF')
AND SEASON_ID IN (SELECT SEASON_ID FROM T_TBL_SEASON
					WHERE SEASON IN('2014-15', '2013-14', '2012-13', '2011-12', '2010-11'));
DELETE FROM SG_PREVIOUS5_SEASONS WHERE GAMES NOT IN(
SELECT MAX(GAMES) FROM SG_PREVIOUS5_SEASONS GROUP BY PLAYER_ID);

CREATE TABLE SG_PREVIOUS5YEARS AS
SELECT SG_PREVIOUS5_SEASONS.PLAYER_ID, SG_PREVIOUS5_SEASONS.SEASON_ID AS SEASON_ID, AGE, POSITION, GAMES, GAMES_STARTED, MINUTES_PLAYED, FIELD_GOALS, FIELD_GOALS_ATTEMPTS, THREE_POINTS_FG, THREE_POINTS_FG_ATTEMPTS, TWO_POINTS_FG, TWO_POINTS_FG_ATTEMPTS, EFF_FIELD_GOAL_PERCENT, FREE_THROWS, FREE_THROWS_ATTEMPTS, ASSISTS, TURNOVERS, POINTS, TEAM, SALARY FROM SG_PREVIOUS5_SEASONS, PLAYER_SALARY_PER_SEASON
WHERE SG_PREVIOUS5_SEASONS.PLAYER_ID == PLAYER_SALARY_PER_SEASON.PLAYER_ID 
AND PLAYER_SALARY_PER_SEASON.SEASON_ID == SG_PREVIOUS5_SEASONS.SEASON_ID;

DROP TABLE SG_PREVIOUS5_SEASONS;






